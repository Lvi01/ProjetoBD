<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja de Cartas Pokémon TCG</title>
    <link rel="stylesheet" href="css/index.css">
</head>
<body>

<div class="container">
    <header>
        <h1>Loja de Cartas Pokémon TCG</h1>
    </header>

    <nav>
        <ul>
            <li><a href="#cartas">Cartas</a></li>
            <li><a href="#clientes">Clientes</a></li>
            <li><a href="#vendas">Vendas</a></li>
            <li><a href="#compras">Compras</a></li>
            <li><a href="#trocas">Trocas</a></li>
        </ul>
    </nav>

    <section id="cartas">
        <h2>Gestão de Cartas</h2>
        <table>
            <caption>Cartas no Estoque</caption>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Tipo</th>
                    <th>Raridade</th>
                    <th>Expansão</th>
                    <th>Condição</th>
                    <th>Preço de Compra</th>
                    <th>Preço de Venda</th>
                    <th>Quantidade</th>
                    <th>Ações</th> 
                </tr>
            </thead>
            <tbody>
                <% if (cartas.length > 0) { %>
                    <% cartas.forEach(function(entry) { %>
                    <tr>
                        <td><%= entry.ID %></td>
                        <td><%= entry.Nome %></td>
                        <td><%= entry.Tipo %></td>
                        <td><%= entry.Raridade %></td>
                        <td><%= entry.Expansao %></td>
                        <td><%= entry.Condicao %></td>
                        <td><%= entry.PrecoCompra %></td>
                        <td><%= entry.PrecoVenda %></td>
                        <td><%= entry.QuantidadeEstoque %></td>
                        <td>
                            <button class="edit-button" onclick="openEditModal('<%= entry.ID %>', '<%= entry.Nome %>', '<%= entry.Tipo %>', '<%= entry.Raridade %>', '<%= entry.Expansao %>', '<%= entry.Condicao %>', '<%= entry.PrecoCompra %>', '<%= entry.PrecoVenda %>', '<%= entry.QuantidadeEstoque %>')">Editar</button>
                            <button class="delete-button" onclick="deleteCard('<%= entry.ID %>')">Excluir</button>
                        </td>
                    </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="10">Nenhuma carta encontrada.</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
        <button class="add-button" onclick="addCard()">Adicionar</button> 
    </section>

    <section id="clientes">
        <h2>Gestão de Clientes</h2>
        <table>
            <caption>Clientes Registrados</caption>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Endereço</th>
                    <th>Telefone</th>
                    <th>Email</th>
                    <th>Ações</th> 
                </tr>
            </thead>
            <tbody>
                <% if (clientes.length > 0) { %>
                    <% clientes.forEach(function(entry) { %>
                    <tr>
                        <td><%= entry.ID %></td>
                        <td><%= entry.Nome %></td>
                        <td><%= entry.Endereco %></td>
                        <td><%= entry.Telefone %></td>
                        <td><%= entry.Email %></td>
                        <td>
                            <button class="edit-button">Editar</button>
                            <button class="delete-button">Excluir</button>
                        </td>
                    </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="6">Nenhum cliente encontrado.</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
        <button class="add-button">Adicionar</button> 
    </section>

    <section id="vendas">
        <h2>Gestão de Vendas</h2>
        <table>
            <caption>Vendas Realizadas</caption>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ID do Cliente</th>
                    <th>Data da Venda</th>
                    <th>Total da Venda</th>
                    <th>Ações</th> 
                </tr>
            </thead>
            <tbody>
                <% function formatDate(date) { 
                    var d = new Date(date);
                    var day = d.getDate();
                    var month = d.getMonth() + 1; // Months are zero based
                    var year = d.getFullYear();
                    return [day, month, year].map(n => n < 10 ? '0' + n : n).join('/');
                } %>
                <% if (vendas.length > 0) { %>
                    <% vendas.forEach(function(entry) { %>
                    <tr>
                        <td><%= entry.ID %></td>
                        <td><%= entry.ClienteID %></td>
                        <td><%= formatDate(entry.DataVenda) %></td>
                        <td><%= entry.TotalVenda %></td>
                        <td>
                            <button class="edit-button">Editar</button>
                            <button class="delete-button">Excluir</button>
                        </td>
                    </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="5">Nenhuma venda encontrada.</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
        <button class="add-button">Adicionar</button> 
    </section>

    <section id="compras">
        <h2>Gestão de Compras</h2>
        <table>
            <caption>Compras Realizadas</caption>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ID do Cliente</th>
                    <th>Data da Compra</th>
                    <th>Total da Compra</th>
                    <th>Ações</th> 
                </tr>
            </thead>
            <tbody>
                <% if (compras.length > 0) { %>
                    <% compras.forEach(function(entry) { %>
                    <tr>
                        <td><%= entry.ID %></td>
                        <td><%= entry.ClienteID %></td>
                        <td><%= formatDate(entry.DataCompra) %></td>
                        <td><%= entry.TotalCompra %></td>
                        <td>
                            <button class="edit-button">Editar</button>
                            <button class="delete-button">Excluir</button>
                        </td>
                    </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="5">Nenhuma compra encontrada.</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
        <button class="add-button">Adicionar</button> 
    </section>

    <section id="trocas">
        <h2>Gestão de Trocas</h2>
        <table>
            <caption>Trocas Realizadas</caption>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>ID do Cliente</th>
                    <th>Data da Troca</th>
                    <th>Ações</th> 
                </tr>
            </thead>
            <tbody>
                <% if (trocas.length > 0) { %>
                    <% trocas.forEach(function(entry) { %>
                    <tr>
                        <td><%= entry.ID %></td>
                        <td><%= entry.ClienteID %></td>
                        <td><%= formatDate(entry.DataTroca) %></td>
                        <td>
                            <button class="edit-button">Editar</button>
                            <button class="delete-button">Excluir</button>
                        </td>
                    </tr>
                    <% }) %>
                <% } else { %>
                    <tr>
                        <td colspan="4">Nenhuma troca encontrada.</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
        <button class="add-button">Adicionar</button> 
    </section>

    <!-- Modais para adicionar e editar -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <form id="modal-form" method="post" action="/cartas">
                <h2 id="modal-title">Adicionar Carta</h2>
                <input type="hidden" name="id" id="modal-id">
                <div>
                    <label for="modal-nome">Nome:</label>
                    <input type="text" name="nome" id="modal-nome" required>
                </div>
                <div>
                    <label for="modal-tipo">Tipo:</label>
                    <input type="text" name="tipo" id="modal-tipo" required>
                </div>
                <div>
                    <label for="modal-raridade">Raridade:</label>
                    <input type="text" name="raridade" id="modal-raridade" required>
                </div>
                <div>
                    <label for="modal-expansao">Expansão:</label>
                    <input type="text" name="expansao" id="modal-expansao" required>
                </div>
                <div>
                    <label for="modal-condicao">Condição:</label>
                    <input type="text" name="condicao" id="modal-condicao" required>
                </div>
                <div>
                    <label for="modal-preco-compra">Preço de Compra:</label>
                    <input type="number" name="preco_compra" id="modal-preco-compra" required>
                </div>
                <div>
                    <label for="modal-preco-venda">Preço de Venda:</label>
                    <input type="number" name="preco_venda" id="modal-preco-venda" required>
                </div>
                <div>
                    <label for="modal-quantidade">Quantidade:</label>
                    <input type="number" name="quantidade" id="modal-quantidade" required>
                </div>
                <button type="submit">Salvar</button>
            </form>
        </div>
    </div>

    <script>
        function addCard() {
            document.getElementById("modal-title").innerText = "Adicionar Carta";
            document.getElementById("modal-id").value = "";
            document.getElementById("modal-nome").value = "";
            document.getElementById("modal-tipo").value = "";
            document.getElementById("modal-raridade").value = "";
            document.getElementById("modal-expansao").value = "";
            document.getElementById("modal-condicao").value = "";
            document.getElementById("modal-preco-compra").value = "";
            document.getElementById("modal-preco-venda").value = "";
            document.getElementById("modal-quantidade").value = "";
            document.getElementById("modal-form").action = "/cartas/add";
            document.getElementById("modal").style.display = "block";
        }

        function openEditModal(id, nome, tipo, raridade, expansao, condicao, precoCompra, precoVenda, quantidade) {
            document.getElementById("modal-title").innerText = "Editar Carta";
            document.getElementById("modal-id").value = id;
            document.getElementById("modal-nome").value = nome;
            document.getElementById("modal-tipo").value = tipo;
            document.getElementById("modal-raridade").value = raridade;
            document.getElementById("modal-expansao").value = expansao;
            document.getElementById("modal-condicao").value = condicao;
            document.getElementById("modal-preco-compra").value = precoCompra;
            document.getElementById("modal-preco-venda").value = precoVenda;
            document.getElementById("modal-quantidade").value = quantidade;
            document.getElementById("modal-form").action = "/cartas/edit";
            document.getElementById("modal").style.display = "block";
        }

        function closeModal() {
            document.getElementById("modal").style.display = "none";
        }

        function deleteCard(id) {
            if (confirm("Tem certeza que deseja excluir esta carta?")) {
                window.location.href = "/cartas/delete/" + id;
            }
        }
    </script>
</div>

</body>
</html>
